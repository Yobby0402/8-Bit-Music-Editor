# 8bit音乐制作器 - 开发进度

## 当前状态

✅ **核心功能已基本完成，软件可正常使用**

## 已完成的功能

### 1. 核心模块 ✅

#### 数据模型 (`core/models.py`)
- ✅ Note（音符）数据模型
- ✅ Track（轨道）数据模型
- ✅ Project（项目）数据模型
- ✅ ADSRParams（包络参数）数据模型
- ✅ WaveformType（波形类型）枚举
- ✅ BassEvent、DrumEvent、DrumType（打击乐事件）
- ✅ 完整的序列化/反序列化支持（JSON格式）
- ✅ 网格格式存储（grid_index, note_value）
- ✅ BPM缩放支持（original_bpm）

#### 波形生成器 (`core/waveform_generator.py`)
- ✅ 方波生成（支持占空比调整）
- ✅ 三角波生成
- ✅ 锯齿波生成
- ✅ 正弦波生成
- ✅ 噪声生成（白噪声、粉噪声）
- ✅ MIDI音符到频率转换
- ✅ 频率到MIDI音符转换

#### 包络处理器 (`core/envelope_processor.py`)
- ✅ ADSR包络生成
- ✅ 包络应用到波形
- ✅ 音高包络生成
- ✅ 颤音效果（Vibrato）
- ✅ 颤音效果（Tremolo）

#### 音频引擎 (`core/audio_engine.py`)
- ✅ 单音符音频生成
- ✅ 轨道音频生成
- ✅ 多轨道音频混合
- ✅ 项目音频生成
- ✅ 实时音频播放（基于Pygame）
- ✅ 音频归一化（防止削波）
- ✅ 打击乐音频生成（底鼓、军鼓、踩镲、吊镲）
- ✅ BPM缩放支持
- ✅ 休止符处理

#### 序列器 (`core/sequencer.py`)
- ✅ 项目管理
- ✅ 轨道管理（添加/删除）
- ✅ 音符管理（添加/删除）
- ✅ 播放控制（播放/暂停/停止）
- ✅ BPM管理
- ✅ 节拍/秒转换
- ✅ 循环区域设置

#### 效果处理器 (`core/effect_processor.py`)
- ✅ 滤波器（低通、高通、带通）
- ✅ 延迟效果
- ✅ 颤音效果（Tremolo - 音量调制）
- ✅ 颤音效果（Vibrato - 音高调制）
- ✅ 效果链处理

#### MIDI导入导出 (`core/midi_io.py`)
- ✅ MIDI文件导入
- ✅ MIDI文件导出
- ✅ 自动提取BPM
- ✅ 多轨道支持
- ✅ 音符转换（音高、时长、力度）

### 2. UI模块 ✅

#### 主窗口 (`ui/main_window.py`)
- ✅ 窗口布局（统一编辑器 + 序列编辑器）
- ✅ 菜单栏（文件、编辑、视图、播放）
- ✅ 播放控制（播放/暂停/停止）
- ✅ 从播放线位置开始播放
- ✅ BPM设置
- ✅ 主音量控制
- ✅ 状态栏
- ✅ 项目文件操作（新建/打开/保存/另存为）
- ✅ WAV导出功能
- ✅ MIDI导入导出功能
- ✅ 键盘快捷键支持
- ✅ 属性面板（浮动窗口，默认隐藏）
- ✅ 创建音轨时自定义名称

#### 统一编辑器 (`ui/unified_editor_widget.py`)
- ✅ 波形选择（方波、三角波、锯齿波、正弦波）
- ✅ 音轨类型选择（主旋律、低音）
- ✅ 钢琴键盘（9个八度，C0-C8）
- ✅ 打击乐按钮（底鼓、军鼓、踩镲、吊镲）
- ✅ 拍数选择（1/4、1/2、1、2、4拍）
- ✅ 休止符按钮
- ✅ 实时预览（悬停播放）
- ✅ 低音预览使用三角波

#### 序列编辑器 (`ui/grid_sequence_widget.py`)
- ✅ 多轨道显示
- ✅ 网格对齐（1/4拍）
- ✅ 音符块显示（按波形颜色区分）
- ✅ 音符拖拽（限制在当前轨道）
- ✅ 音符吸附到网格
- ✅ 多选功能（框选）
- ✅ 键盘删除（Delete/Backspace）
- ✅ 全选功能（Ctrl+A）
- ✅ 重叠检测和位置交换
- ✅ 水平滚动（Shift + 滚轮）
- ✅ 水平缩放（Alt + 滚轮）
- ✅ 播放头显示
- ✅ 播放线点击和拖动定位
- ✅ 播放线自动吸附到1/4拍网格
- ✅ 网格线自适应显示（根据缩放级别）
- ✅ 增量更新（避免刷新时空白闪烁）
- ✅ 高亮显示目标音轨
- ✅ 动态调整场景大小

#### 属性面板 (`ui/property_panel_widget.py`)
- ✅ 音符属性编辑（音高、时长、力度、波形）
- ✅ ADSR包络编辑
- ✅ 时长按1/4拍步进
- ✅ 轨道效果编辑（滤波器、延迟、颤音）
- ✅ 实时更新序列编辑器
- ✅ 调节时长时自动调整后续音符位置

#### 节拍器 (`ui/metronome_widget.py`)
- ✅ 可视化节拍器（4个节拍指示器）
- ✅ 开启/关闭开关
- ✅ BPM显示
- ✅ 水平布局
- ✅ 播放时同步

#### 钢琴键盘 (`ui/piano_keyboard_widget.py`)
- ✅ 9个八度选择（C0-C8）
- ✅ 黑白键交错布局
- ✅ 实时预览（悬停播放）
- ✅ 点击添加音符
- ✅ 休止符按钮集成

#### 时间轴 (`ui/timeline_widget.py`)
- ✅ 时间轴显示
- ✅ 小节线和拍线
- ✅ 播放头显示
- ✅ BPM显示

### 3. 功能特性 ✅

#### 音符编辑
- ✅ 点击钢琴键盘添加音符
- ✅ 拖拽音符调整位置
- ✅ 音符吸附到1/4拍网格
- ✅ 多选和批量删除
- ✅ 属性面板实时编辑
- ✅ 调节时长时后续音符自动移动

#### 播放功能
- ✅ 播放/暂停/停止
- ✅ 从播放线位置开始播放
- ✅ 播放线点击定位
- ✅ 播放线拖动定位
- ✅ 播放线自动吸附到1/4拍网格
- ✅ 播放头实时显示
- ✅ BPM调整
- ✅ 主音量控制
- ✅ 节拍器同步
- ✅ 循环播放（可选）

#### 导入导出
- ✅ 项目保存/加载（JSON格式）
- ✅ WAV文件导出
- ✅ MIDI文件导入
- ✅ MIDI文件导出

#### 键盘快捷键
- ✅ Space - 播放/暂停
- ✅ Ctrl+S - 保存
- ✅ Ctrl+O - 打开
- ✅ Ctrl+N - 新建
- ✅ Ctrl+A - 全选
- ✅ Ctrl+E - 导出WAV
- ✅ Delete/Backspace - 删除选中音符
- ✅ Ctrl+. - 停止

### 4. 项目配置 ✅

- ✅ 项目目录结构
- ✅ requirements.txt（依赖管理）
- ✅ README.md（项目说明）
- ✅ .gitignore（版本控制）

## 项目结构

```
8bit/
├── core/                          # 核心模块
│   ├── __init__.py
│   ├── models.py                  # 数据模型
│   ├── waveform_generator.py     # 波形生成器
│   ├── envelope_processor.py     # 包络处理器
│   ├── audio_engine.py           # 音频引擎
│   ├── sequencer.py              # 序列器
│   ├── effect_processor.py       # 效果处理器
│   ├── midi_io.py                # MIDI导入导出
│   └── track_events.py           # 轨道事件类型
├── ui/                            # UI模块
│   ├── __init__.py
│   ├── main_window.py            # 主窗口
│   ├── unified_editor_widget.py  # 统一编辑器
│   ├── grid_sequence_widget.py  # 序列编辑器
│   ├── property_panel_widget.py # 属性面板
│   ├── metronome_widget.py      # 节拍器
│   ├── piano_keyboard_widget.py # 钢琴键盘
│   ├── timeline_widget.py       # 时间轴
│   └── ...                       # 其他UI组件
├── main.py                        # 程序入口
├── requirements.txt               # 依赖列表
└── README.md                      # 项目说明
```

## 技术栈

- **Python 3.10+**
- **PyQt5** - GUI框架
- **NumPy** - 数值计算和波形生成
- **SciPy** - 音频处理（WAV文件）
- **Pygame** - 音频播放
- **mido** - MIDI文件处理

## 使用方法

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行程序

```bash
python main.py
```

### 基本操作

1. **添加音符**：在统一编辑器中点击钢琴键盘或打击乐按钮
2. **编辑音符**：在序列编辑器中点击音符，在属性面板中编辑
3. **调整位置**：在序列编辑器中拖拽音符
4. **播放音乐**：点击播放按钮或按Space键
5. **保存项目**：文件菜单 → 保存（Ctrl+S）
6. **导出音频**：文件菜单 → 导出WAV（Ctrl+E）
7. **导入MIDI**：文件菜单 → 导入MIDI

## 待实现功能

### 优先级功能

1. ⏳ **和弦编辑器** - 快速添加和弦
2. ⏳ **琶音器** - 自动生成琶音
3. ⏳ **自动化（Automation）** - 参数自动化曲线

### 可选功能

- 音效库系统
- 项目模板
- 更多效果（压缩器、环形调制等）
- MIDI键盘支持

## 已知问题

- 无

## 贡献

欢迎提交Issue和Pull Request！
