# 8bit音乐制作器 - 更新日志

## v3.1.1 - Fixed some visual bugs

### 🐛 Bug修复

- **音轨列表显示问题**
  - 修复了左侧音轨名称列表的显示同步问题，现在与右侧视图完全同步
  - 移除了复选框和滚动按钮，界面更简洁
  - 动态显示可见音轨，根据右侧视图自动调整显示数量

- **多选功能优化**
  - 修复了多选时只有最后一个音轨上的音符高亮的问题
  - 现在所有选中轨道上的音符都会正确高亮显示
  - 支持 Ctrl+点击进行多选音轨
  - 支持 Shift+点击进行范围选择

- **音符显示修复**
  - 修复了 MIDI 导入后音符聚集在左上角的问题
  - 修复了音符位置计算错误，现在音符从起点（x=0）开始显示，与播放线对齐
  - 移除了音轨名称标签，音符显示更清晰，不再有视觉偏移

- **交互体验改进**
  - 修复了高亮逻辑，只高亮真正选中的音轨，不会因为滚动而错误变化
  - 添加了点击空白处取消选择的功能
  - 改进了堆叠布局的位置计算，确保音符位置正确

---

## v3.0.0 - Seed-based style music generation (Preview)

### ✨ 新增功能（V3 预览）

- **基于 Seed 的多风格音乐自动生成（核心功能初版）**
  - 新增 `core/seed_music_generator.py`，引入统一的 `get_rng_from_seed(seed)`，同一 Seed + 同一风格生成结果完全可复现。
  - 支持多种曲风枚举 `SeedMusicStyle`：`CLASSIC_8BIT / LOFI / BATTLE / SUSPENSE / CALM`。
  - 新增 `StyleParams`，可按风格集中配置波形、占空比、ADSR、鼓点力度比例等声音参数。
  - 新增 `generate_simple_project_from_seed(seed, length_bars, style)`：一键生成带 **主旋律 / 低音 / 和声 / 鼓点** 的完整 Project。

- **曲风逻辑与情绪细化**
  - **战斗（BATTLE）**：  
    - 提高默认 BPM（更紧张）、主旋律使用短促重复触发（类似双击/多击），鼓点密集（每拍都有鼓），低音稳定推进。  
  - **悬疑（SUSPENSE）**：  
    - 使用接近日式和风小调（Phrygian / In / Hirajoshi 风格），突出 1、♭2、4、5、♭7 等度数，整体音高抬到中高音区避免发闷。  
    - 强拍更容易落在“危险音”（♭2 / ♭6 / ♭7），弱拍带少量半音邻音抖动。  
    - 主旋律采用覆盖整小节的「三连击」节奏：短促但连续，避免只在前半小节响、后半小节空白。  
    - 设计“恐怖和弦模板”和安静小节（部分轨道静音、长音悬挂），营造压抑与空间感。  
    - 主旋律轨加入高通滤波与颤音（Vibrato），声音更尖锐、带轻微不稳定感。  
  - **舒缓（CALM）**：  
    - 以大调与稳定和声走向（如 I–IV–V–I 的变体）为主，时值更长，旋律跳进受限，整体力度更柔和。  
  - **经典 8bit / Lofi**：  
    - 使用典型 8bit 方波 / 三角波 / 锯齿波组合，不同风格有不同 ADSR 和鼓点密度，分别偏“复古芯片感”和“更柔和、偏背景”的感觉。

- **UI 集成与 BPM 同步**
  - 主菜单新增「从 Seed 生成音乐…」入口，对话框支持：选择曲风、输入 Seed、指定小节数。  
  - Seed 生成完成后，自动更新 **BPM 显示和全局组件**：`bpm_spinbox`、节拍器、序列编辑器、统一编辑器、属性面板、示波器等，确保 UI 与实际播放速度一致。

> V3 致力于在「保持可编辑」的前提下，让 Seed 一键生成的结果具备可用的情绪和层次，  
> 帮助快速打出战斗 / 悬疑 / 舒缓等不同氛围的“草稿曲”，再由创作者进行后期精修。

---

## v2.4 - Fix numerous critical bugs

### 🛠 Summary

- **Fix numerous critical bugs** in the V2 series, including:
  - UI layout and alignment issues (track list, grid, dock panels).
  - Settings application and theming problems (colors, fonts, gradients).
  - Oscilloscope stability and playback-sync issues.
  - MIDI import timing / overlap behavior and drum editing bugs.

> V2 focuses on **polishing and solidifying the core music creation workflow**  
> (sequencing, editing, playback, oscilloscope, MIDI I/O, and score library),  
> making the 8-bit music editor stable and reliable for everyday use.

---

## v0.4.0 - UI优化和播放线功能

### ✨ 新增功能

#### 播放线功能
- ✅ **播放线点击定位**
  - 点击时间轴区域或播放线附近可定位播放线
  - 自动吸附到1/4拍网格
  - 支持从播放线位置开始播放

- ✅ **播放线拖动**
  - 支持拖动播放线到任意位置
  - 实时更新播放线位置
  - 拖动时自动吸附到网格

#### UI优化
- ✅ **统一编辑器布局优化**
  - 钢琴键盘占70%宽度，按钮区域占30%宽度
  - 波形、插入模式、拍数按钮横向多排排列
  - 去掉所有标签文字，界面更简洁

- ✅ **网格线自适应显示**
  - 根据缩放级别自动调整网格线密度
  - 缩小时只显示小节线和拍线
  - 放大时才显示16分音符线

- ✅ **增量更新优化**
  - 避免刷新时出现空白闪烁
  - 只更新变化的部分，提升性能

- ✅ **音轨高亮显示**
  - 正在插入音符的目标音轨以橙色高亮显示
  - 点击音轨或添加音符时自动高亮

- ✅ **属性面板优化**
  - 改为浮动窗口（DockWidget），默认隐藏
  - 可通过菜单显示/隐藏
  - 显示时在右侧，可移动和浮动

- ✅ **创建音轨功能**
  - 添加音轨时可自定义名称
  - 支持选择音轨类型（音符音轨/打击乐音轨）

### 🔧 改进

- 优化了UI布局，界面更紧凑美观
- 改进了刷新性能，减少闪烁
- 增强了播放线交互体验
- 修复了批量删除时的内存访问错误

---

## v0.3.0 - 效果处理和MIDI支持

### ✨ 新增功能

#### 效果处理
- ✅ **效果处理器模块（EffectProcessor）**
  - 滤波器（低通、高通、带通）
  - 延迟效果（可调延迟时间、反馈、混合比例）
  - 颤音效果（Tremolo - 音量调制）
  - 颤音效果（Vibrato - 音高调制）
  - 效果链处理

- ✅ **属性面板效果编辑**
  - 滤波器参数编辑（类型、截止频率、共振）
  - 延迟参数编辑（延迟时间、反馈、混合比例）
  - 颤音参数编辑（速度、深度）
  - 实时应用效果

#### MIDI导入导出
- ✅ **MIDI文件导入**
  - 支持标准MIDI文件（.mid, .midi）
  - 自动提取BPM
  - 多轨道支持
  - 保留音高、时长、力度

- ✅ **MIDI文件导出**
  - 导出为标准MIDI格式
  - 保留所有轨道
  - 保留BPM信息
  - 兼容其他MIDI软件

#### 属性面板优化
- ✅ 时长按1/4拍步进
- ✅ 调节时长时自动调整后续音符位置
- ✅ 实时更新序列编辑器显示

---

## v0.2.0 - UI界面完善

### ✨ 新增功能

#### UI组件
- ✅ **统一编辑器（UnifiedEditorWidget）**
  - 整合主旋律、低音、打击乐编辑
  - 波形选择（带颜色区分）
  - 钢琴键盘（9个八度）
  - 打击乐按钮（居中显示）
  - 实时预览功能

- ✅ **序列编辑器（GridSequenceWidget）**
  - 网格对齐（1/4拍）
  - 音符拖拽和吸附
  - 多选功能（框选）
  - 水平滚动和缩放
  - 播放头显示
  - 重叠检测和位置交换

- ✅ **属性面板（PropertyPanelWidget）**
  - 音符属性编辑
  - ADSR包络编辑
  - 轨道效果编辑
  - 浮动窗口支持

- ✅ **节拍器（MetronomeWidget）**
  - 可视化节拍器（4个节拍指示器）
  - 开启/关闭开关
  - 水平布局

- ✅ **钢琴键盘（PianoKeyboardWidget）**
  - 9个八度选择（C0-C8）
  - 黑白键交错布局
  - 实时预览
  - 休止符按钮

#### 主窗口功能
- ✅ 完整的菜单栏（文件、编辑、视图、播放）
- ✅ 键盘快捷键支持
- ✅ 项目文件操作（新建/打开/保存/另存为）
- ✅ WAV导出功能
- ✅ 属性面板浮动窗口

### 🔧 改进

- 优化了UI布局（统一编辑器 + 序列编辑器）
- 改进了音符编辑体验
- 添加了实时预览功能
- 优化了打击乐按钮布局

---

## v0.1.0 - 核心功能实现

### ✨ 核心模块

- ✅ 数据模型（Note, Track, Project）
- ✅ 波形生成器（5种波形）
- ✅ 包络处理器（ADSR）
- ✅ 音频引擎（生成和播放）
- ✅ 序列器（项目管理）
- ✅ 基础UI框架

### 🎵 音效演示

- ✅ 7种游戏音效生成
- ✅ 交互式音效试听
- ✅ WAV文件导出

---

## 使用方法

### 运行程序
```bash
python main.py
```

### 基本操作
1. **添加音符**：在统一编辑器中点击钢琴键盘或打击乐按钮
2. **编辑音符**：在序列编辑器中点击音符，在属性面板中编辑
3. **调整位置**：在序列编辑器中拖拽音符
4. **播放音乐**：点击播放按钮或按Space键
5. **保存项目**：文件菜单 → 保存（Ctrl+S）
6. **导出音频**：文件菜单 → 导出WAV（Ctrl+E）
7. **导入MIDI**：文件菜单 → 导入MIDI

### 键盘快捷键
- **Space** - 播放/暂停
- **Ctrl+S** - 保存
- **Ctrl+O** - 打开
- **Ctrl+N** - 新建
- **Ctrl+A** - 全选
- **Ctrl+E** - 导出WAV
- **Delete/Backspace** - 删除选中音符
- **Ctrl+.** - 停止

---

## 贡献

欢迎提交Issue和Pull Request！
